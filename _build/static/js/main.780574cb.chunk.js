(this.webpackJsonppbn=this.webpackJsonppbn||[]).push([[0],{126:function(e,t,a){"use strict";(function(e){a.d(t,"a",(function(){return w}));var r=a(42),n=a(43),i=a(131),o=a(130),c=a(0),l=a.n(c),s=a(47),h=a(127),d=a(28),u=a(20),g=a(21),f=a(14),b=a(34),m=a(128),v=a(129),j=a(1),x=a(298),p=a(300),y=function(e,t){return e.r===t.r&&e.g===t.g&&e.b===t.b&&e.a===t.a},w=function(t){Object(i.a)(c,t);var a=Object(o.a)(c);function c(e){var t;return Object(r.a)(this,c),(t=a.call(this,e)).baseImage=void 0,t.coloredImage=void 0,t.pbnImage=void 0,t.pallete=void 0,t.palleteSize=10,t.pallete=[],t.state={status:"Awaiting Input"},t}return Object(n.a)(c,[{key:"generateColoredImage",value:function(){console.log("Generating colored image");var e=this.state;if(e.status="Generating colored image...",this.setState(e),this.baseImage&&0!==this.pallete.length){this.coloredImage=d.a.fromPicture(this.baseImage);for(var t=0;t<this.coloredImage.height;++t)for(var a=0;a<this.coloredImage.width;++a)this.coloredImage.setPixelToClosestColor(a,t,this.pallete);(e=this.state).status="Finished generating colored image.",this.setState(e),this.generatePBNImage()}else console.error("Cannot generate colored image without base image or color pallete.")}},{key:"generatePBNImage",value:function(){console.log("Generating PBN image...");var e=this.state;if(e.status="Generating PBN image...",this.setState(e),this.coloredImage){for(var t=Array(this.coloredImage.width),a=0;a<this.coloredImage.width;++a){var r=Array(this.coloredImage.height);r.fill(!1),t[a]=r}for(var n=[],i=0;i<this.coloredImage.width;++i)for(var o=0;o<this.coloredImage.height;++o){var c=this.findOutline(this.coloredImage,t,i,o);c&&n.push(c)}this.pbnImage=new d.a(this.coloredImage.width,this.coloredImage.height);var l={r:0,g:0,b:0,a:255};this.pbnImage.fill({r:255,g:255,b:255,a:255});for(var s=0;s<n.length;++s)for(var h=n[s],u=0;u<h.outline.length;++u){var g=h.outline[u];this.pbnImage.setPixel(g.x,g.y,l)}(e=this.state).status="Finished generatign PBN image.",this.setState(e)}else console.error("Cannot generate PBN Image without the colored image.")}},{key:"findOutline",value:function(e,t,a,r){var n={points:[],outline:[]},i={x:a,y:r},o=e.getPixel(i.x,i.y);if(t[i.x][i.y])return null;for(var c=[{x:-1,y:0},{x:0,y:1},{x:1,y:0},{x:0,y:-1}],l=[{x:i.x,y:i.y}];l.length>0;){t[(i=l.pop()).x][i.y]=!0,n.points.push(i);for(var s=0;s<c.length;++s){var h=c[s],d={x:i.x+h.x,y:i.y+h.y},u=e.getPixel(d.x,d.y);d.x>=0&&d.y>=0&&d.x<e.width&&d.y<e.height&&y(u,o)&&!t[d.x][d.y]&&l.push(d),(d.x<=0||d.y<=0||d.x>=e.width||d.y>=e.height||!y(u,o))&&n.outline.push(i)}}return n}},{key:"generateDownloadLinks",value:function(t){var a=void 0;if("pbn"===t?a=this.pbnImage:"colored"===t&&(a=this.coloredImage),a){var r=e.from(p(a.data,[a.width,a.height],"png")),n=new Blob([r]),i=URL.createObjectURL(n),o=document.createElement("a");o.href=i,o.download=t+".png",document.body.appendChild(o),o.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window})),document.body.removeChild(o),console.log("Download Complete")}}},{key:"showImage",value:function(e){e&&(Object(s.c)(e),Object(s.b)())}},{key:"kmeansCallbackFactory",value:function(){var e=this,t=this.state;t.status="Picking color palette (this may take a while)...",this.setState(t);return function(t,a){if(t){console.error(t);var r=e.state;return r.status="Error occurred while picking colors.",void e.setState(r)}var n=new Array(a.length);for(var i in a){var o=a[i].centroid,c={r:Math.round(o[0]),g:Math.round(o[1]),b:Math.round(o[2]),a:Math.round(o[3])};n[i]=c}Object.assign(e.pallete,n);var l=e.state;l.status="Finished picking color pallete",e.setState(l),e.generateColoredImage()}}},{key:"palleteSizeCallbackFactory",value:function(){var e=this;return function(t){e.palleteSize=t}}},{key:"pickerCallbackFactory",value:function(){var e=this;return function(t){"base"===t?e.showImage(e.baseImage):"color"===t?e.showImage(e.coloredImage):"pbn"===t&&e.showImage(e.pbnImage)}}},{key:"imageUploadCallbackFactory",value:function(){var e=this;return function(t){var a=e.state;a.status="Loading image...",e.setState(a),e.baseImage=d.a.fromJimp(t),e.showImage(e.baseImage),(a=e.state).status="Image loaded, waiting to start.",e.setState(a)}}},{key:"kickoffGeneration",value:function(){this.baseImage&&(x.clusterize(this.baseImage.toRGBAVector(),{k:this.palleteSize},this.kmeansCallbackFactory()),console.log("Started Finding Colors."))}},{key:"render",value:function(){var e=this,t=this.state.status;return Object(j.jsx)(u.a,{fluid:!0,children:Object(j.jsx)(g.a,{className:"justify-content-center",children:Object(j.jsxs)(f.a,{children:[Object(j.jsx)(h.a,{imageCallback:this.imageUploadCallbackFactory()}),Object(j.jsx)(v.a,{palleteSizeUpdatedCallback:this.palleteSizeCallbackFactory(),defaultSize:10}),Object(j.jsx)(u.a,{children:Object(j.jsx)(g.a,{className:"justify-content-center",children:Object(j.jsx)(f.a,{children:Object(j.jsx)(b.a,{onClick:function(){return e.kickoffGeneration()},children:"Create PBN Image"})})})}),Object(j.jsx)(m.a,{pickerCallback:this.pickerCallbackFactory()}),Object(j.jsx)(u.a,{children:Object(j.jsx)(g.a,{className:"justify-content-center",children:Object(j.jsx)(f.a,{children:Object(j.jsxs)("h3",{className:"text-center",children:["Status: ",t]})})})}),Object(j.jsx)(s.a,{}),Object(j.jsx)(u.a,{children:Object(j.jsxs)(g.a,{className:"justify-content-center py-3",children:[Object(j.jsx)(f.a,{children:Object(j.jsx)(b.a,{disabled:!this.coloredImage,onClick:function(){return e.generateDownloadLinks("colored")},children:"Download Colored image"})}),Object(j.jsx)(f.a,{children:Object(j.jsx)(b.a,{disabled:!this.pbnImage,onClick:function(){return e.generateDownloadLinks("pbn")},children:"Download PBN image"})})]})})]})})})}}]),c}(l.a.Component)}).call(this,a(4).Buffer)},127:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));a(0);var r=a(44),n=a.n(r),i=a(20),o=a(21),c=a(14),l=a(1),s=function(e){return Object(l.jsx)(i.a,{className:"py-3",children:Object(l.jsx)(o.a,{className:"justify-content-center",children:Object(l.jsx)(c.a,{children:Object(l.jsx)("input",{type:"file",id:"input",onChange:function(t){if(t.persist(),t.currentTarget.files&&0!==t.currentTarget.files.length){var a=t.currentTarget.files[0],r=new FileReader;r.readAsArrayBuffer(a),r.onload=function(){var t=r.result;n.a.read(t,(function(t,a){t?console.error("Jimp Failed to Load Image with Message: "+t.message):e.imageCallback(a)}))},r.onerror=function(){console.error("File Reader encountered an eorror")}}}})})})})}},128:function(e,t,a){"use strict";a.d(t,"a",(function(){return d}));var r=a(46),n=a(0),i=a(20),o=a(21),c=a(14),l=a(335),s=a(33),h=a(1),d=function(e){var t=Object(n.useState)("base"),a=Object(r.a)(t,2),d=a[0],u=a[1];return Object(h.jsx)(i.a,{className:"py-3",children:Object(h.jsx)(o.a,{className:"justify-content-center",children:Object(h.jsx)(c.a,{children:Object(h.jsxs)(l.a,{className:"mb-2",value:d,onChange:function(t){u(t),e.pickerCallback(t)},name:"options",children:[Object(h.jsx)(s.a,{type:"radio",value:"base",children:"Show Base Image"}),Object(h.jsx)(s.a,{type:"radio",value:"color",children:"Show Color Image"}),Object(h.jsx)(s.a,{type:"radio",value:"pbn",children:"Show PBN Image"})]})})})})}},129:function(e,t,a){"use strict";a.d(t,"a",(function(){return h}));var r=a(46),n=a(0),i=a(20),o=a(21),c=a(14),l=a(49),s=a(1),h=function(e){var t=Object(n.useState)(e.defaultSize),a=Object(r.a)(t,2),h=a[0],d=a[1];return Object(s.jsx)(i.a,{className:"py-3",children:Object(s.jsx)(o.a,{className:"justify-content-center",children:Object(s.jsx)(c.a,{children:Object(s.jsx)(l.a,{children:Object(s.jsxs)(l.a.Group,{controlId:"palleteSize",children:[Object(s.jsxs)(l.a.Label,{children:["Pallete Size (how many colors are in your pallete): ",h]}),Object(s.jsx)(l.a.Control,{type:"range",max:30,min:2,defaultValue:h,onChange:function(t){var a=t.currentTarget.value;e.palleteSizeUpdatedCallback(a),d(a)}})]})})})})})}},143:function(e,t,a){},144:function(e,t,a){},173:function(e,t){},175:function(e,t){},187:function(e,t){},189:function(e,t){},28:function(e,t,a){"use strict";a.d(t,"a",(function(){return c}));var r=a(42),n=a(43),i=a(44),o=a.n(i),c=function(){function e(t,a,n){if(Object(r.a)(this,e),this._width=t,this._height=a,this._data=n,this.width=void 0,this.height=void 0,this.data=void 0,this.width=t,this.height=a,this.data=new Uint8Array(t*a*4),n)for(var i=0;i<n.length;++i)this.data[i]=n[i]}return Object(n.a)(e,[{key:"setPixel",value:function(e,t,a){var r=4*(t*this.width+e);this.data[r+0]=a.r,this.data[r+1]=a.g,this.data[r+2]=a.b,this.data[r+3]=a.a}},{key:"setPixelToClosestColor",value:function(e,t,a){for(var r=this.getPixel(e,t),n=1e3,i=-1,o=0;o<a.length;++o){var c=a[o],l=Math.sqrt(Math.pow(r.r-c.r,2)+Math.pow(r.g-c.g,2)+Math.pow(r.b-c.b,2));l<n&&(n=l,i=o)}var s=a[i];this.setPixel(e,t,s)}},{key:"getPixel",value:function(e,t){var a=4*(t*this.width+e);return{r:this.data[a+0],g:this.data[a+1],b:this.data[a+2],a:this.data[a+3]}}},{key:"toRGBAVector",value:function(){for(var e=new Array(this.data.length/4),t=0;t<this.height;++t)for(var a=0;a<this.width;++a){var r=4*(t*this.width+a),n=[this.data[r+0],this.data[r+1],this.data[r+2],this.data[r+3]];e[r/4]=n}return e}},{key:"fill",value:function(e){for(var t=0;t<this.width;++t)for(var a=0;a<this.height;++a)this.setPixel(t,a,e)}}],[{key:"fromJimp",value:function(t){for(var a=new e(t.getWidth(),t.getHeight()),r=0;r<a.height;++r)for(var n=0;n<a.width;++n){var i=o.a.intToRGBA(t.getPixelColor(n,r));a.setPixel(n,r,i)}return a}},{key:"fromPicture",value:function(t){for(var a=new e(t.width,t.height),r=0;r<a.height;++r)for(var n=0;n<a.width;++n){var i=t.getPixel(n,r);a.setPixel(n,r,i)}return a}}]),e}()},334:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),i=a(125),o=a.n(i),c=(a(143),a(144),a(126)),l=a(20),s=a(21),h=a(14),d=a(1);var u=function(){return Object(d.jsx)(l.a,{className:"App py-3",children:Object(d.jsx)(s.a,{className:"justify-content-center",children:Object(d.jsxs)(h.a,{children:[Object(d.jsx)("h1",{className:"display-1 text-center",children:"PBN App"}),Object(d.jsx)(c.a,{})]})})})},g=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,336)).then((function(t){var a=t.getCLS,r=t.getFID,n=t.getFCP,i=t.getLCP,o=t.getTTFB;a(e),r(e),n(e),i(e),o(e)}))};o.a.render(Object(d.jsx)(n.a.StrictMode,{children:Object(d.jsx)(u,{})}),document.getElementById("root")),g()},47:function(e,t,a){"use strict";a.d(t,"c",(function(){return w})),a.d(t,"b",(function(){return E})),a.d(t,"a",(function(){return R}));var r,n=a(0),i=a(20),o=a(21),c=a(28),l=a(15),s=a(1),h=null,d=null,u=null,g=null,f=[-1,1,1,1,-1,-1,1,-1],b=[0,1,2,1,3,2],m=l.a.create(),v=null,j=l.a.create(),x=null,p=l.a.create(),y=null,w=function(e){if(h){var t=document.getElementById(r);if(t){var a=t.getContext("webgl");if(a){var n=e.width>e.height?e.width:e.height;p[0]=e.width/n,p[5]=e.height/n;var i=a.RGBA,o=a.RGBA,c=a.UNSIGNED_BYTE;a.bindTexture(a.TEXTURE_2D,h),a.texImage2D(a.TEXTURE_2D,0,i,e.width,e.height,0,o,c,e.data),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE)}else console.error("Failed to get webgl context")}else console.log("Failed to find canvas to init webGL.")}else console.error("Cannot set texture until it has been instantiated in GL.")},E=function(){var e=document.getElementById(r);if(e){var t=e.getContext("webgl");t?(t.bindTexture(t.TEXTURE_2D,h),t.activeTexture(t.TEXTURE0),t.uniform1i(d,0),t.uniformMatrix4fv(v,!1,m),t.uniformMatrix4fv(x,!1,j),t.uniformMatrix4fv(y,!1,p),t.bindBuffer(t.ARRAY_BUFFER,u),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,g),t.clearColor(.9,.9,.9,1),t.enable(t.DEPTH_TEST),t.clear(t.COLOR_BUFFER_BIT),t.viewport(0,0,e.width,e.height),t.drawElements(t.TRIANGLES,b.length,t.UNSIGNED_SHORT,0),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)):console.error("Failed to get webgl context")}else console.log("Failed to find canvas to init webGL.")},R=function(e){return"undefined"===(r=String(e.canvasId))&&(r="gl-canvas"),Object(n.useEffect)((function(){!function(e){var t=document.getElementById(r);if(t){var a=t.getContext("webgl");if(a){l.a.ortho(m,-1,1,-1,1,1e-4,3);var n=l.b.fromValues(0,0,0),i=l.b.fromValues(0,0,-1),o=l.b.fromValues(0,1,0);l.a.lookAt(j,n,i,o),l.a.identity(p),u=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,u),a.bufferData(a.ARRAY_BUFFER,new Float32Array(f),a.STATIC_DRAW),a.bindBuffer(a.ARRAY_BUFFER,null),g=a.createBuffer(),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,g),a.bufferData(a.ELEMENT_ARRAY_BUFFER,new Uint16Array(b),a.STATIC_DRAW),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,null);var s=a.createShader(a.VERTEX_SHADER);if(s){a.shaderSource(s,"\nuniform mat4 proj;\nuniform mat4 view;\nuniform mat4 aspectRatio;\nattribute vec2 coordinates;\n\nvarying highp vec2 uv;\nvoid main() {\n    \n    highp vec4 pos = vec4(coordinates.x, coordinates.y , -1.0, 1.0);\n    gl_Position = proj * view * aspectRatio * pos;\n\n    uv = (coordinates + 1.0)/2.0;\n    uv.y = 1.0 - uv.y;\n}\n"),a.compileShader(s);var R=a.getShaderParameter(s,a.COMPILE_STATUS);if(R){var O=a.createShader(a.FRAGMENT_SHADER);if(O)if(a.shaderSource(O,"\nuniform sampler2D tex;\nvarying highp vec2 uv;\nconst highp vec3 bgColor = vec3(0.9, 0.9, 0.9); \nvoid main() {\n    highp vec4 color = texture2D(tex, uv);\n    gl_FragColor = vec4((gl_FragCoord.x)/400.0, 1.0 - (gl_FragCoord.y)/400.0, 0.0, 1.0);\n    gl_FragColor = color;\n}\n"),a.compileShader(O),R=a.getShaderParameter(O,a.COMPILE_STATUS)){var I=a.createProgram();if(I)if(a.attachShader(I,s),a.attachShader(I,O),a.linkProgram(I),a.useProgram(I),a.getProgramParameter(I,a.LINK_STATUS)){a.bindBuffer(a.ARRAY_BUFFER,u);var T=a.getAttribLocation(I,"coordinates");if(a.vertexAttribPointer(T,2,a.FLOAT,!1,0,0),a.enableVertexAttribArray(T),a.bindBuffer(a.ARRAY_BUFFER,null),d=a.getUniformLocation(I,"tex"),v=a.getUniformLocation(I,"proj"),x=a.getUniformLocation(I,"view"),y=a.getUniformLocation(I,"aspectRatio"),h=a.createTexture()){var A=new c.a(1,1,new Uint8Array([255,255,255,255]));w(A),E()}else console.error("GL Failed to created a texture.")}else console.error(a.getProgramInfoLog(I));else console.error("Couldn't create the shader program.")}else console.error(a.getShaderInfoLog(O));else console.error("Fragment Shader failed to load.")}else console.error(a.getShaderInfoLog(s))}else console.error("Vertex Shader failed to load.")}else console.error("Failed to get webgl context")}else console.log("Failed to find canvas to init webGL.")}()}),[]),Object(s.jsx)(i.a,{children:Object(s.jsxs)(o.a,{className:"justify-content-center",children:[Object(s.jsx)("p",{children:Object(s.jsx)("i",{children:"Note: PBN outlines will look better once downloaded. The image below is just a preview."})}),Object(s.jsx)("canvas",{id:r,className:"p-0 rounded PBNRenderer"})]})})}}},[[334,1,2]]]);
//# sourceMappingURL=main.780574cb.chunk.js.map